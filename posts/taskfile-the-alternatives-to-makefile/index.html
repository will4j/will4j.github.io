<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Makefile 平替：跨平台构建脚本 Taskfile - 程序员水王</title><meta name=author content>
<meta name=author-link content><meta name=description content="自动化构建工具 go-task 使用介绍。"><meta name=keywords content="Taskfile"><meta itemprop=name content="Makefile 平替：跨平台构建脚本 Taskfile"><meta itemprop=description content="自动化构建工具 go-task 使用介绍。"><meta itemprop=datePublished content="2023-12-14T20:16:00+08:00"><meta itemprop=dateModified content="2023-12-20T16:31:24+08:00"><meta itemprop=wordCount content="3075"><meta itemprop=keywords content="Taskfile,"><meta property="og:title" content="Makefile 平替：跨平台构建脚本 Taskfile"><meta property="og:description" content="自动化构建工具 go-task 使用介绍。"><meta property="og:type" content="article"><meta property="og:url" content="https://will4j.github.io/posts/taskfile-the-alternatives-to-makefile/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-14T20:16:00+08:00"><meta property="article:modified_time" content="2023-12-20T16:31:24+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Makefile 平替：跨平台构建脚本 Taskfile"><meta name=twitter:description content="自动化构建工具 go-task 使用介绍。"><meta name=application-name content="程序员水王"><meta name=apple-mobile-web-app-title content="程序员水王"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://will4j.github.io/posts/taskfile-the-alternatives-to-makefile/><link rel=prev href=https://will4j.github.io/posts/github-contribution-grid-snake/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Makefile 平替：跨平台构建脚本 Taskfile","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/will4j.github.io\/posts\/taskfile-the-alternatives-to-makefile\/"},"genre":"posts","keywords":"Taskfile","wordcount":3075,"url":"https:\/\/will4j.github.io\/posts\/taskfile-the-alternatives-to-makefile\/","datePublished":"2023-12-14T20:16:00+08:00","dateModified":"2023-12-20T16:31:24+08:00","license":"by 水王","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"水王"},"description":"自动化构建工具 go-task 使用介绍。"}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title=程序员水王><span class=header-title-pre><i class="fa fa-code">&nbsp</i></span><span id=typeit-header-desktop class=typeit></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/><i class="fa-solid fa-home fa-fw fa-sm" aria-hidden=true></i> 首页</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th-list fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=程序员水王><span class=header-title-pre><i class="fa fa-code">&nbsp</i></span><span id=typeit-header-title-mobile class=typeit></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/><i class="fa-solid fa-home fa-fw fa-sm" aria-hidden=true></i> 首页</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th-list fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class=breadcrumb-container><ol class=breadcrumb><li class=breadcrumb-item><a href=/posts/ title=文章>文章</a></li><li class="breadcrumb-item active" aria-current=page>Makefile 平替：跨平台构建脚本 Taskfile</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Makefile 平替：跨平台构建脚本 Taskfile</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
水王</span></span>
<span class=post-category>收录于 <a href=/categories/tools/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 实用工具</a></span></div><div class=post-meta-line><span title="发布于 2023-12-14 20:16:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-12-14>2023-12-14</time></span>&nbsp;<span title="更新于 2023-12-20 16:31:24"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-12-20>2023-12-20</time></span>&nbsp;<span title="3075 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 3100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 7 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Makefile 平替：跨平台构建脚本 Taskfile">
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#工具安装>工具安装</a></li><li><a href=#基本使用>基本使用</a><ol><li><a href=#命令参数>命令参数</a></li><li><a href=#任务依赖>任务依赖</a></li><li><a href=#环境变量>环境变量</a></li><li><a href=#变量>变量</a></li><li><a href=#工作目录>工作目录</a></li><li><a href=#引用其他-taskfile>引用其他 Taskfile</a></li></ol></li><li><a href=#进阶使用>进阶使用</a><ol><li><a href=#动态变量>动态变量</a></li><li><a href=#非必要不执行>非必要不执行</a><ol><li><a href=#文件内容比对>文件内容比对</a></li><li><a href=#命令执行比对>命令执行比对</a></li></ol></li><li><a href=#go-模板引擎>go 模板引擎</a></li></ol></li><li><a href=#windows-环境使用>Windows 环境使用</a></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ol></nav></div></div><div class=content id=content><p>Task 是用 Go 语言编写的任务执行/构建工具，对比 GNU make，Task 语法规则[<a href=https://taskfile.dev/api/#taskfile-schema target=_blank rel="external nofollow noopener noreferrer">1</a>]更加简单且语义化，学习成本更低，同时 Task 脚本支持跨平台执行，除了 Linux 和 Mac 外，Windows 系统通过使用 GitBash 也能完全兼容执行。使用 Task 编写构建任务、自动化脚本，可以极大提高开发协作效率。</p><p>Task 执行文件为 <code>Taskfile</code>，采用 <code>yaml</code> 格式，下面以 cowsay 为例进行快速开始演示：</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;This is the default task&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>silent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>cowsay &#34;Are you ready to go task ?&#34;</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ task
</span></span><span class=line><span class=cl> ___________________________
</span></span><span class=line><span class=cl>&lt; Are you ready to go task ? &gt;
</span></span><span class=line><span class=cl> ---------------------------
</span></span><span class=line><span class=cl>        <span class=se>\ </span>  ^__^
</span></span><span class=line><span class=cl>         <span class=se>\ </span> <span class=o>(</span>oo<span class=o>)</span><span class=se>\_</span>______
</span></span><span class=line><span class=cl>            <span class=o>(</span>__<span class=o>)</span><span class=se>\ </span>      <span class=o>)</span><span class=se>\/\
</span></span></span><span class=line><span class=cl><span class=se></span>                <span class=o>||</span>----w <span class=p>|</span>
</span></span><span class=line><span class=cl>                <span class=o>||</span>     <span class=o>||</span></span></span></code></pre></td></tr></table></div></div><p><code>default</code> 任务非必须，是 Task 不带任务参数执行时的默认选项，可以通过 <code>task --list</code> 或者 <code>task -l</code> 查看所有可执行任务。</p><h2 id=工具安装>工具安装</h2><p>Task 安装非常方便，参考官方安装文档[<a href=https://taskfile.dev/installation/ target=_blank rel="external nofollow noopener noreferrer">2</a>]，支持多种包管理工具，比如 Mac / Linux 平台的 Homebrew、Tea，Windows 平台的 Chocolatey、Scoop，Node 的 npm，也可以使用安装包、安装脚本或者直接从源码编译安装。以 brew 为例：</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ brew install go-task
</span></span><span class=line><span class=cl>$ task --version
</span></span><span class=line><span class=cl>Task version: 3.32.0</span></span></code></pre></td></tr></table></div></div><h2 id=基本使用>基本使用</h2><p>Task 有非常完善的使用文档[<a href=https://taskfile.dev/usage/ target=_blank rel="external nofollow noopener noreferrer">3</a>]，可以先快速浏览，然后在实际使用时作为手册查阅。</p><h3 id=命令参数>命令参数</h3><p>Task 的核心是任务，对应 <code>cmds</code> 参数，支持多种格式[<a href=https://taskfile.dev/api/#command target=_blank rel="external nofollow noopener noreferrer">4</a>]，最常用的是执行 shell 命令或者执行其他 task。</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>example task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 执行 shell 命令</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>cmd</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;hello world&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 直接输入字符串与 cmd 等价</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;hello world&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 多行 shell 脚本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        cat &lt;&lt; EOF &gt; output.txt
</span></span></span><span class=line><span class=cl><span class=sd>        hello world
</span></span></span><span class=line><span class=cl><span class=sd>        EOF</span><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># 执行其它 task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>another</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>another</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>another example task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>cat output.txt</span></span></span></code></pre></td></tr></table></div></div><h3 id=任务依赖>任务依赖</h3><p>除了可以使用 <code>cmds.task</code> 直接调用执行其他任务外，还可以通过 <code>deps</code> 声明任务依赖，在当前任务开始前，所有依赖会先执行完成，多个依赖项并行执行。</p><p>如下所示：</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deps</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>before_1, before_2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;after&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;before 1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;before 2&#34;</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ task
</span></span><span class=line><span class=cl>before <span class=m>2</span>
</span></span><span class=line><span class=cl>before <span class=m>1</span>
</span></span><span class=line><span class=cl>after</span></span></code></pre></td></tr></table></div></div><h3 id=环境变量>环境变量</h3><p>通过设置环境变量可以控制命令行为（比如调整 pypi 镜像）。 使用 <code>env</code> 设置全局环境变量，使用 <code>Task.env</code> 设置任务局部环境变量，环境变量使用 <code>$</code> 符号访问。</p><p>如下示例中，<code>install</code> 任务识别全局环境变量使用清华源加速，<code>install-test</code> 任务识别单独配置环境变量使用阿里云源加速：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PIP_INDEX_URL</span><span class=p>:</span><span class=w> </span><span class=l>https://pypi.tuna.tsinghua.edu.cn/simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>install</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>install requirements.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>pip install -r requirements.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>install-test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>install test packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>PIP_INDEX_URL</span><span class=p>:</span><span class=w> </span><span class=l>https://mirrors.aliyun.com/pypi/simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>cmd</span><span class=p>:</span><span class=w> </span><span class=l>echo using index $PIP_INDEX_URL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>silent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>pip install pytest pytest-cov</span></span></span></code></pre></td></tr></table></div></div><h3 id=变量>变量</h3><p>变量在 <code>Taskfile</code> 脚本中使用，可以增强任务灵活度，方便任务复用。使用 <code>vars</code> 设置全局变量，使用 <code>Task.vars</code> 设置任务局部变量，变量使用 go 模板如 <code>{{.VAR_NAME}}</code> 访问。</p><p>变量取值按优先级从高到低依次为：</p><ol><li><code>Task.vars</code> 中定义的任务局部变量值</li><li>被其他任务直接调用时在 <code>Command.vars</code> 中定义的变量值</li><li>通过命令行参数传入的变量值</li><li>通过 <code>includes</code> 导入的外部 <code>Taskfile</code> 中定义的全局变量值</li><li>当前 <code>Taskfile</code> 中定义的全局变量值</li><li>通过 <code>includes</code> 导入的外部 <code>Taskfile</code> 中定义的全局环境变量值</li><li>当前 <code>Taskfile</code> 中定义的全局环境变量值</li><li>通过命令行参数传入的环境变量值</li><li>系统环境变量值</li></ol><p>通过下面的示例来演示变量取值，任务 <code>echo</code> 在控制台输出变量 <code>MESSAGE</code> 的值：</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>includes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docs</span><span class=p>:</span><span class=w> </span><span class=l>Taskfile1.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v7&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>do-echo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo {{.MESSAGE}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>echo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>echo message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>do-echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v2&#34;</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Taskfile1.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v4&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>MESSAGE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;v6&#34;</span></span></span></code></pre></td></tr></table></div></div><p>根据顺序执行，<code>{{.MESSAGE}}</code> 取值按照优先级从高到低依次为 <code>v1</code> 到 <code>v9</code>，其中 <code>v3</code> 是命令行参数传入的变量值，<code>v8</code> 是命令行参数传入的环境变量值，<code>v9</code> 是系统环境变量值：</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>MESSAGE</span><span class=o>=</span>v9
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span> <span class=nv>MESSAGE</span><span class=o>=</span>v3
</span></span><span class=line><span class=cl>v1
</span></span><span class=line><span class=cl><span class=c1># 注释掉 v1 后执行</span>
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span> <span class=nv>MESSAGE</span><span class=o>=</span>v3
</span></span><span class=line><span class=cl>v2
</span></span><span class=line><span class=cl><span class=c1># 注释掉 v2 后执行</span>
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span> <span class=nv>MESSAGE</span><span class=o>=</span>v3
</span></span><span class=line><span class=cl>v3
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span>
</span></span><span class=line><span class=cl>v4
</span></span><span class=line><span class=cl><span class=c1># 依次注释掉 v4，v5，v6 后执行</span>
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span>
</span></span><span class=line><span class=cl><span class=c1># 结果依次为 v5，v6，v7</span>
</span></span><span class=line><span class=cl><span class=c1># 注释掉 v7 后执行</span>
</span></span><span class=line><span class=cl>$ <span class=nv>MESSAGE</span><span class=o>=</span>v8 task <span class=nb>echo</span>
</span></span><span class=line><span class=cl>v8
</span></span><span class=line><span class=cl>$ task <span class=nb>echo</span>
</span></span><span class=line><span class=cl>v9</span></span></code></pre></td></tr></table></div></div><h3 id=工作目录>工作目录</h3><p>默认情况下，所有任务命令会在 <code>Taskfile</code> 所在目录执行，可以通过 <code>dir</code> 指定命令执行目录，比如下面的任务会在 <code>client</code> 目录执行客户端构建：</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client:build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>build client dist file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dir</span><span class=p>:</span><span class=w> </span><span class=l>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>yarn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>yarn build</span></span></span></code></pre></td></tr></table></div></div><h3 id=引用其他-taskfile>引用其他 Taskfile</h3><p>Taskfile 引用可以在多种场景中发挥作用，比方说引入通用工具类，或者根据功能不同将任务按文件进行分组等。</p><p>可以像如下示例中的 <code>docs</code> 一样直接使用路径进行引入，也可以像 <code>dev</code> 一样定义参数引入，需要注意的是，引入后的所有命令默认都在当前 <code>Taskfile</code> 目录下执行，除非通过 <code>dir</code> 参数修改引入脚本的执行目录。</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>includes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docs</span><span class=p>:</span><span class=w> </span><span class=l>docs/Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dev</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>taskfile</span><span class=p>:</span><span class=w> </span><span class=l>dev/Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REQ_FILE</span><span class=p>:</span><span class=w> </span><span class=l>requirements-dev.txt</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># dev/Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>REQ_FILE</span><span class=p>:</span><span class=w> </span><span class=l>requirements.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>build dev environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;build with {{.REQ_FILE}}&#34;</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docs/Taskfile.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>build docs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#34;build docs&#34;</span></span></span></code></pre></td></tr></table></div></div><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ task --list
</span></span><span class=line><span class=cl>task: Available tasks <span class=k>for</span> this project:
</span></span><span class=line><span class=cl>* dev:build:        build dev environment
</span></span><span class=line><span class=cl>* docs:build:       build docs</span></span></code></pre></td></tr></table></div></div><h2 id=进阶使用>进阶使用</h2><h3 id=动态变量>动态变量</h3><p>可以通过 shell 脚本在运行时动态设置变量的值。比如下面的任务会获取当前 Git 提交哈希值设置变量 <code>IMAGE_TAG</code>：</p><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>IMAGE_TAG</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sh</span><span class=p>:</span><span class=w> </span><span class=l>git rev-parse --short HEAD</span></span></span></code></pre></td></tr></table></div></div><h3 id=非必要不执行>非必要不执行</h3><p>对于有中间产物生成的任务，可以通过设置条件判断中间产物是否需要更新，从而减少不必要的任务执行。</p><p>通过 <code>task --force</code> 或者 <code>task -f</code> 可以强制执行任务。</p><h4 id=文件内容比对>文件内容比对</h4><p>Task 通过 <code>sources</code> 和 <code>generates</code> 指定源文件和中间产物，支持文件路径或者 glob 表达式，提供两种校验方式：</p><ul><li><code>checksum</code>： 中间产物生成后，Task 记录源文件的校验和，只有当源文件校验和发生变更时任务才需要重新执行</li><li><code>timestamp</code>：Task 记录最后一次任务执行时间，只有当任一源文件修改时间比最后执行任务时间新时任务才需要重新执行</li></ul><p>默认方式为 <code>timestamp</code>，两种校验方式可以通过观察项目根目录下的 .task 文件夹内容验证。使用示例如下：</p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>go build .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./*.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>generates</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>app{{exeExt}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=l>checksum</span><span class=w> </span><span class=c># or timestamp</span></span></span></code></pre></td></tr></table></div></div><h4 id=命令执行比对>命令执行比对</h4><p>可以通过 <code>status</code> 运行命令测试，根据命令执行结果判断中间产物是否需要更新，这种方式具有非常大的灵活度。</p><p>比如下面的例子判断只要 <code>directory</code> 目录以及其下的两个文件存在，任务就不需要重复执行：</p><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>generate-files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mkdir directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>touch directory/file1.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>touch directory/file2.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># test existence of files</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test -d directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test -f directory/file1.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test -f directory/file2.txt</span></span></span></code></pre></td></tr></table></div></div><h3 id=go-模板引擎>go 模板引擎</h3><p>Task 脚本在执行之前会使用 Go 模板引擎[<a href=https://taskfile.dev/usage/#gos-template-engine target=_blank rel="external nofollow noopener noreferrer">5</a>]进行解析，支持全部 slim-sprig 库函数[<a href=https://go-task.github.io/slim-sprig/ target=_blank rel="external nofollow noopener noreferrer">6</a>]以及 Task 额外增加的平台相关等函数。</p><p>使用示例如下：</p><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>print-os</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#39;{{OS}} {{ARCH}}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#39;{{if eq OS &#34;windows&#34;}}windows-command{{else}}unix-command{{end}}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># This will be path/to/file on Unix but path\to\file on Windows</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo &#39;{{fromSlash &#34;path/to/file&#34;}}&#39;</span></span></span></code></pre></td></tr></table></div></div><h2 id=windows-环境使用>Windows 环境使用</h2><p>开头介绍 Task 时说到 Windows 完全兼容执行需要依赖 GitBash，实际上 Task 使用 go 原生 sh 解析库 mvdan/sh [<a href=https://github.com/mvdan/sh target=_blank rel="external nofollow noopener noreferrer">7</a>]解析 shell 脚本，其提供非完全跨平台的能力，使用 GitBash 是为了补齐 Windows 不支持的部分内置 shell 命令，如 <code>rm</code>、<code>mv</code> 等，所以这里进行单独说明，Windows 平台按照使用指南</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 使用 管理员权限 打开 powershell</span>
</span></span><span class=line><span class=cl><span class=c1># 一行命令安装 Chocolatey</span>
</span></span><span class=line><span class=cl>$ Set-ExecutionPolicy Bypass -Scope Process -Force<span class=p>;</span> <span class=o>[</span>System.Net.ServicePointManager<span class=o>]</span>::SecurityProtocol <span class=o>=</span> <span class=o>[</span>System.Net.ServicePointManager<span class=o>]</span>::SecurityProtocol -bor 3072<span class=p>;</span> iex <span class=o>((</span>New-Object System.Net.WebClient<span class=o>)</span>.DownloadString<span class=o>(</span><span class=s1>&#39;https://community.chocolatey.org/install.ps1&#39;</span><span class=o>))</span>
</span></span><span class=line><span class=cl><span class=c1># 验证 Chocolatey</span>
</span></span><span class=line><span class=cl>$ choco
</span></span><span class=line><span class=cl><span class=c1># 使用 Chocolatey 安装 go-task</span>
</span></span><span class=line><span class=cl>$ choco install go-task
</span></span><span class=line><span class=cl><span class=c1># 打开 GitBash 窗口，执行 task 命令</span>
</span></span><span class=line><span class=cl>$ task --list</span></span></code></pre></td></tr></table></div></div><h2 id=总结>总结</h2><p>使用 Task 将项目构建过程定义为自动化脚本，在提升工作效率的同时，同时也是在进行知识沉淀，类似的脚本可以复用，不断丰富自己的工具箱。</p><p>下面是我在 Python 项目中基本都会使用到的一段脚本，主要功能包括：</p><ol><li>根据 conda 虚拟环境目录是否存在，自动执行虚拟环境创建或者虚拟环境更新；</li><li>识别 <code>environment.yml</code>，<code>requirements.txt</code> 配置文件修改时间，判断是否需要重新执行依赖安装；</li><li>设置 <code>PYTHONPATH</code> 环境变量为项目根目录，遵循 Python 模块路径导入规范；</li></ol><p>使用这段脚本后，不管是初次克隆项目还是项目代码更新，只需要简单执行 <code>task</code> 命令然后回车，脚本就会自动处理虚拟环境设置工作，多人协作时大家使用相同的脚本构建可以保证环境一致性。同时因为监听了配置文件修改时间，多次重复执行 <code>task</code> 命令也不会有负担。</p><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CONDA_PREFIX</span><span class=p>:</span><span class=w> </span><span class=l>./venv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CONDA_ENV_FILE</span><span class=p>:</span><span class=w> </span><span class=l>environment.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PIP_REQ_FILE</span><span class=p>:</span><span class=w> </span><span class=l>requirements.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>build or update venv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>venv:build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>silent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>venv:build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>build conda venv when config file updated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>venv:inner-build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>venv:config-vars</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>silent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>venv:inner-build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>silent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test ! -d {{.CONDA_PREFIX}} || conda env update -f {{.CONDA_ENV_FILE}} -p {{.CONDA_PREFIX}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test -d {{.CONDA_PREFIX}} || conda env create -f {{.CONDA_ENV_FILE}} -p {{.CONDA_PREFIX}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>touch {{.CONDA_PREFIX}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test {{.CONDA_PREFIX}} -nt {{.CONDA_ENV_FILE}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test {{.CONDA_PREFIX}} -nt {{.PIP_REQ_FILE}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>venv:config-vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>desc</span><span class=p>:</span><span class=w> </span><span class=l>config environment variables of venv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>conda env config vars set PYTHONPATH=&#34;{{.PYTHONPATH}}&#34; -p {{.CONDA_PREFIX}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>PYTHONPATH</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>sh</span><span class=p>:</span><span class=w> </span><span class=l>pwd</span></span></span></code></pre></td></tr></table></div></div><h2 id=参考资料>参考资料</h2><p>[1]. <a href=https://taskfile.dev/api/#taskfile-schema target=_blank rel="external nofollow noopener noreferrer">Taskfile 语法规则</a><br>[2]. <a href=https://taskfile.dev/installation/ target=_blank rel="external nofollow noopener noreferrer">Task 官方安装文档</a><br>[3]. <a href=https://taskfile.dev/usage/ target=_blank rel="external nofollow noopener noreferrer">Task 官方使用指南</a><br>[4]. <a href=https://taskfile.dev/api/#command target=_blank rel="external nofollow noopener noreferrer">Task 命令参数</a><br>[5]. <a href=https://taskfile.dev/usage/#gos-template-engine target=_blank rel="external nofollow noopener noreferrer">Task Go 模板引擎</a><br>[6]. <a href=https://go-task.github.io/slim-sprig/ target=_blank rel="external nofollow noopener noreferrer">slim-sprig 库函数</a><br>[7]. <a href=https://github.com/mvdan/sh target=_blank rel="external nofollow noopener noreferrer">GitHub：mvdan/sh</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-12-20 16:31:24">更新于 2023-12-20&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/taskfile-the-alternatives-to-makefile/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://will4j.github.io/posts/taskfile-the-alternatives-to-makefile/ data-title="Makefile 平替：跨平台构建脚本 Taskfile" data-hashtags=Taskfile><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://will4j.github.io/posts/taskfile-the-alternatives-to-makefile/ data-title="Makefile 平替：跨平台构建脚本 Taskfile"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/taskfile/ class=post-tag>Taskfile</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/github-contribution-grid-snake/ class=post-nav-item rel=prev title="GitHub 提交记录贪食蛇动画"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>GitHub 提交记录贪食蛇动画</a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=will4j/blog-resource data-repo-id=R_kgDOKus4vg data-category="Blog Comments" data-category-id=DIC_kwDOKus4vs4CbCP2 data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.120.4">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18-lts.5"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright order-last" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=/></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics order-first"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/will4j title="Visit Me on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/index.umd.js defer></script><script src=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-desktop":"程序员水王","typeit-header-title-mobile":"程序员水王"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2023-11-16T07:40:29+08:00",typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},duration:-1,loop:!1,speed:100}}</script><script src=/js/theme.min.js defer></script></body></html>